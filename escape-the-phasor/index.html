escape-the-phasor/
    â””â”€â”€ index.html
<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Escape the Phasor â€“ Å¡kolskÃ¡ ÃºnikovÃ¡ hra (v2)</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root{--bg:#0b1020;--card:#0e1628;--edge:#1f2a44;--txt:#e5e7eb;--muted:#9aa4b2;--acc:#5b9cff;--ok:#22c55e;--warn:#f59e0b;--err:#ef4444}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:radial-gradient(1200px 800px at 20% 0%,#0e1830 0%,#0b1020 40%,#070b17 100%);color:var(--txt)}
    .wrap{max-width:1000px;margin:0 auto;padding:24px}
    .card{background:linear-gradient(180deg,rgba(18,27,48,.9),rgba(11,16,32,.9));border:1px solid var(--edge);border-radius:18px;padding:22px;box-shadow:0 12px 40px rgba(0,0,0,.35)}
    h1{margin:0 0 8px;font-size:clamp(22px,3.2vw,36px)}
    h2{margin:0 0 12px;font-size:clamp(18px,2.4vw,24px)}
    p{color:var(--muted);line-height:1.6}
    .row{display:grid;gap:18px}
    @media (min-width:860px){.row{grid-template-columns:1fr 1fr}}
    label{display:block;margin:10px 0 6px}
    input,button,select{width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--edge);background:#0a1222;color:var(--txt)}
    input:focus,select:focus,button:focus{outline:2px solid var(--acc)}
    button{background:var(--acc);border-color:var(--acc);font-weight:700;cursor:pointer}
    button.secondary{background:transparent;border-color:var(--edge)}
    button:disabled{opacity:.6;cursor:not-allowed}
    .hidden{display:none}
    .pill{display:inline-flex;gap:8px;align-items:center;font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--edge);background:#0a1222;color:#cbd5e1}
    .ok{border-color:#134e2a;background:rgba(34,197,94,.12);color:var(--txt)}
    .err{border-color:#7f1d1d;background:rgba(239,68,68,.12)}
    .progress{height:10px;border-radius:999px;background:#0a1222;border:1px solid var(--edge);overflow:hidden;margin:12px 0}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,#22c55e,#5b9cff)}
    .grid{display:grid;gap:18px}
    .task{border:1px dashed var(--edge);border-radius:14px;padding:16px;background:rgba(8,13,26,.6);position:relative}
    .task.locked{opacity:.6}
    .task h3{margin:0 0 8px}
    .note{font-size:13px;color:#9aa4b2}
    .right{color:#22c55e}
    .wrong{color:#ef4444}
    .center{text-align:center}
    .footer{margin-top:18px;color:#8aa0bb;font-size:13px}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#0a1222;border:1px solid var(--edge);border-radius:8px;padding:2px 6px}
    canvas{width:100%;max-width:560px;height:220px;background:#081024;border:1px solid var(--edge);border-radius:12px}
    .lockBadge{position:absolute;top:12px;right:12px;padding:4px 8px;border-radius:999px;border:1px solid var(--edge);background:#0a1222;font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">

    <!-- ÃšVODNÃ OBRAZOVKA -->
    <section class="card" id="screen-welcome">
      <h1>Escape the Phasor</h1>
      <p>VirtuÃ¡lna ÃºnikovÃ¡ hra o striedavÃ½ch obvodoch. Prejdi 10 Ãºloh od harmonickÃ©ho priebehu cez reaktanciu aÅ¾ po fÃ¡zu <span class="kbd">U</span> a <span class="kbd">I</span>. Funguje v prehliadaÄi â€“ bez servera.</p>
      <div class="row">
        <div>
          <label for="player">Meno / prezÃ½vka</label>
          <input id="player" placeholder="napr. Janka" />
          <button id="btnStart">ZaÄaÅ¥ hru</button>
          <p id="msgStart" class="footer"></p>
        </div>
        <div>
          <p><b>Tip pre uÄiteÄ¾a:</b> strÃ¡nka je oznaÄenÃ¡ <span class="kbd">noindex</span>, takÅ¾e nie je vyhÄ¾adateÄ¾nÃ¡. Postup hrÃ¡Äa sa ukladÃ¡ lokÃ¡lne (localStorage).</p>
          <button id="btnResetAll" class="secondary">VymazaÅ¥ uloÅ¾enÃ½ postup</button>
        </div>
      </div>
    </section>

    <!-- HRA -->
    <section class="card hidden" id="screen-game">
      <div class="row">
        <div>
          <h2 id="gameTitle">LaboratÃ³rium â€“ 10 zÃ¡mkov</h2>
          <div class="progress"><div class="bar" id="bar"></div></div>
          <p class="pill">HrÃ¡Ä: <span id="who">â€“</span> â€¢ ÄŒas: <span id="timer">00:00</span></p>
        </div>
        <div class="center">
          <button id="btnBack" class="secondary">SpÃ¤Å¥ na Ãºvod</button>
        </div>
      </div>

      <div id="tasks" class="grid"></div>
      <div id="finish" class="hidden center">
        <h2>ğŸ‰ Ãšnik sa podaril!</h2>
        <p>SkvelÃ©! MÃ¡Å¡ vÅ¡etky zÃ¡mky otvorenÃ©. CelkovÃ½ Äas: <b><span id="finalTime">â€“</span></b>.</p>
      </div>
    </section>

  </div>

  <script>
  // ====================== PomocnÃ© funkcie ==========================
  const $ = (s)=>document.querySelector(s);
  const el = (tag, attrs={}, html='')=>{ const n=document.createElement(tag); Object.entries(attrs).forEach(([k,v])=> n.setAttribute(k,v)); if(html) n.innerHTML=html; return n; };
  const fmtTime = (ms)=>{ const s=Math.floor(ms/1000); const m=Math.floor(s/60); const r=s%60; return `${String(m).padStart(2,'0')}:${String(r).padStart(2,'0')}` };
  const nearly = (val, target, tol)=>(Math.abs(Number(val)-target) <= tol);
  const save = (k,v)=> localStorage.setItem(k, JSON.stringify(v));
  const load = (k,def)=>{ try{ const v=JSON.parse(localStorage.getItem(k)); return v??def; }catch{ return def; } };

  // ====================== DefinÃ­cia Ãºloh ============================
  // Tiering: 1-5 open, 6-9 unlock when first 5 solved, 10 unlock when first 9 solved
  const TASKS = [
    { id:'u1', tier:1, title:'ÄŒasovÃ½ priebeh', text:'MÃ¡me u(t) = 325 Â· sin(2Ï€Â·50Â·t). UrÄi okamÅ¾itÃº hodnotu u pri t = 3 ms. (V)',
      input:'number', placeholder:'napr. 263', tol:2,
      solve:(v)=> nearly(v, 325*Math.sin(2*Math.PI*50*0.003), 2), hint:'PouÅ¾i u=UmaxÂ·sin(Ï‰t), Ï‰=2Ï€f, t=0,003 s.' },
    { id:'u2', tier:1, title:'MaximÃ¡lna hodnota', text:'Ak Uef = 230 V, urÄ Umax. (V)',
      input:'number', placeholder:'napr. 325', tol:1,
      solve:(v)=> nearly(v, 230*Math.SQRT2, 1), hint:'Umax = UefÂ·âˆš2.' },
    { id:'u3', tier:1, title:'EfektÃ­vna hodnota', text:'Ak Umax = 10 V, urÄ Uef. (V)',
      input:'number', placeholder:'napr. 7.07', tol:0.05,
      solve:(v)=> nearly(v, 10/Math.SQRT2, 0.05), hint:'Uef = Umax/âˆš2.' },
    { id:'u4', tier:1, title:'StrednÃ¡ hodnota (usmernenÃ¡)', text:'Pre jednocestne usmernenÃ© sÃ­nusovÃ© napÃ¤tie platÃ­ Ustred â‰ˆ 0,637Â·Umax. Ak Umax = 325 V, urÄ Ustred. (V)',
      input:'number', placeholder:'napr. 207', tol:2,
      solve:(v)=> nearly(v, 0.637*325, 2), hint:'Ustred = (2/Ï€)Â·Umax â‰ˆ 0,637Â·Umax.' },
    { id:'u5', tier:1, title:'Odpor R', text:'VypoÄÃ­taj odpor: U = 230 V, I = 2 A. R = ? (Î©)',
      input:'number', placeholder:'napr. 115', tol:0.5,
      solve:(v)=> nearly(v, 115, 0.5), hint:'R = U/I.' },

    { id:'u6', tier:2, title:'InduktÃ­vna reaktancia X_L', text:'Pre f = 50 Hz a L = 0,10 H urÄ X_L. (Î©)',
      input:'number', placeholder:'napr. 31.4', tol:0.5,
      solve:(v)=> nearly(v, 2*Math.PI*50*0.10, 0.5), hint:'X_L = Ï‰L = 2Ï€fL.' },
    { id:'u7', tier:2, title:'KapacitnÃ¡ reaktancia X_C', text:'Pre f = 50 Hz a C = 100 ÂµF urÄ X_C. (Î©)',
      input:'number', placeholder:'napr. 31.8', tol:0.5,
      solve:(v)=> nearly(v, 1/(2*Math.PI*50*100e-6), 0.5), hint:'X_C = 1/(Ï‰C) = 1/(2Ï€fC).' },
    { id:'u8', tier:2, title:'Impedancia Z', text:'V sÃ©riovom RLC platÃ­ R = 40 Î©, X_L = 30 Î©, X_C = 10 Î©. UrÄ Z. (Î©)',
      input:'number', placeholder:'napr. 44.7', tol:0.5,
      solve:(v)=> nearly(v, Math.sqrt(40**2 + (30-10)**2), 0.5), hint:'Z = âˆš(RÂ² + (X_Lâˆ’X_C)Â²).' },

    { id:'u9', tier:2, title:'Ohmov zÃ¡kon pre AC â€“ fÃ¡zory',
      text:'Pre I = 2 A s poÄiatoÄnou fÃ¡zou Ï†_I = âˆ’10Â° a sÃ©riovÃ½ RLC: R=40 Î©, X_L=30 Î©, X_C=10 Î©.            UrÄi fÃ¡zor napÃ¤tia U = IÂ·Z.            Zadaj <b>veÄ¾kosÅ¥</b> |U| (V) a <b>uhol</b> Ï†_U (Â°).',
      type:'phasorSolve', magPlaceholder:'napr. 89.4', angPlaceholder:'napr. 16.6',
      magTol:0.7, angTol:1.0,
      // Correct values: |Z| = sqrt(40^2 + 20^2) = 44.721..., Ï†Z = atan(20/40) â‰ˆ 26.565Â°
      // |U| = I*|Z| = 2 * 44.721... = 89.442...,  Ï†U = Ï†I + Ï†Z = -10 + 26.565 = 16.565Â°
      magTarget: 2*Math.sqrt(40*40 + (30-10)*(30-10)),
      angTarget: (-10) + Math.atan2(30-10,40)*180/Math.PI,
      hint:'|U| = IÂ·|Z|, Ï†_U = Ï†_I + Ï†_Z, priÄom Ï†_Z = arctan((X_Lâˆ’X_C)/R).' },

    { id:'u10', tier:3, title:'FÃ¡zovÃ½ posun (fÃ¡zor) â€“ nastavenie',
      text:'Pre sÃ©riovÃ½ RLC s R = 40 Î© a (X_Lâˆ’X_C) = 20 Î© nastav fÃ¡zu napÃ¤tia voÄi prÃºdu Ï†. (Â°)',
      type:'phasor', target: Math.atan2(20,40)*180/Math.PI, tol:2,
      hint:'Ï† = arctan((X_L âˆ’ X_C)/R). Pre XL>XC je napÃ¤tie VEDIE prÃºd (kladnÃ½ uhol).' }
  ];

  // ====================== Stav hry ==================================
  const STATE_KEY = 'phasor-escape-state-v2';
  let state = load(STATE_KEY, { name:'', startAt:0, solved:{}, savedVals:{} });

  function saveState(){ save(STATE_KEY, state); }

  // ====================== UI â€“ Å¡tart a ÄasovaÄ ======================
  const screenWelcome = $('#screen-welcome');
  const screenGame = $('#screen-game');
  const tasksWrap = $('#tasks');
  const bar = $('#bar');
  const who = $('#who');
  const timerEl = $('#timer');
  const finalTime = $('#finalTime');
  let tHandle=null;

  function startTimer(){
    stopTimer();
    tHandle = setInterval(()=>{
      const now=Date.now();
      if(!state.startAt) state.startAt=now;
      timerEl.textContent = fmtTime(now - state.startAt);
    }, 250);
  }
  function stopTimer(){ if(tHandle) clearInterval(tHandle); }

  function solvedCountUpToTier(tierMax){
    return TASKS.filter(t=> t.tier<=tierMax && state.solved[t.id]).length;
  }

  function updateProgress(){
    const done = Object.keys(state.solved).filter(k=> state.solved[k]).length;
    const pct = Math.round(100*done/TASKS.length);
    bar.style.width = pct+"%";
    if(done===TASKS.length){
      $('#finish').classList.remove('hidden');
      finalTime.textContent = fmtTime(Date.now()-state.startAt);
    }
  }

  // ====================== Render Ãºloh ===============================
  function renderTasks(){
    tasksWrap.innerHTML='';
    const doneTier1 = solvedCountUpToTier(1);
    const unlockTier2 = doneTier1 >= 5; // po 5 ÃºlohÃ¡ch
    const doneTier2 = TASKS.filter(t=> t.tier===2 && state.solved[t.id]).length;
    const unlockTier3 = (unlockTier2 && (doneTier1 + doneTier2) >= 9);

    TASKS.forEach((t,i)=>{
      let unlocked = t.tier===1 || (t.tier===2 && unlockTier2) || (t.tier===3 && unlockTier3);
      const card = el('div',{class:'task'+(unlocked?'':' locked'), id:`task-${t.id}`});
      const h3 = el('h3',{}, `${i+1}. ${t.title}`);
      const p = el('p',{}, t.text);
      card.append(h3,p);

      if(!unlocked){
        const badge = el('div',{class:'lockBadge'}, (t.tier===2?'ğŸ”’ DokonÄi prvÃ½ch 5 Ãºloh':'ğŸ”’ DokonÄi prvÃ½ch 9 Ãºloh'));
        card.append(badge);
        tasksWrap.append(card);
        return;
      }

      const solved = !!state.solved[t.id];

      if(t.type==='phasor'){
        const canvas = el('canvas',{id:`cv-${t.id}`});
        const slider = el('input',{type:'range', min:'-90', max:'90', step:'0.1', value: solved? t.target.toFixed(1): (state.savedVals[t.id]?.ang ?? '0')});
        const out = el('p',{class:'note'}, `Uhol Ï†: <b><span id="ang-${t.id}">${slider.value}</span>Â°</b>`);
        const btn = el('button',{id:`btn-${t.id}`}, 'SkontrolovaÅ¥');
        const msg = el('p',{class:'note', id:`msg-${t.id}`}, '');
        card.append(canvas, slider, out, btn, msg);

        try { drawPhasor(canvas, Number(slider.value)); } catch(e) {}

        slider.addEventListener('input',()=>{
          document.querySelector(`#ang-${t.id}`).textContent = slider.value;
          state.savedVals[t.id] = {ang: slider.value}; saveState();
          try { drawPhasor(canvas, Number(slider.value)); } catch(e) {}
        });

        if(solved){ slider.value = t.target.toFixed(1); slider.disabled=true; btn.disabled=true; out.innerHTML = `Uhol Ï†: <b>${slider.value}Â°</b>`; msg.textContent='âœ… SprÃ¡vne!'; msg.className='note right'; }

        btn.addEventListener('click',()=>{
          const ang = Number(slider.value);
          if(Math.abs(ang - t.target) <= t.tol){
            state.solved[t.id]=true; saveState();
            msg.textContent = 'âœ… SprÃ¡vne!'; msg.className='note right';
            slider.disabled=true; btn.disabled=true;
            try { drawPhasor(canvas, t.target); } catch(e) {}
            updateProgress(); renderTasks(); // refresh kvÃ´li odomykaniu
          } else {
            msg.textContent = `âŒ EÅ¡te nie. SkÃºs Â±${t.tol}Â° okolo sprÃ¡vnej hodnoty. NÃ¡poveda: ${t.hint}`;
            msg.className='note wrong';
          }
        });

      } else if(t.type==='phasorSolve'){
        const row = el('div', {class:'row'});
        const mag = el('input', {type:'number', step:'any', placeholder:t.magPlaceholder||'veÄ¾kosÅ¥ (V)'});
        const ang = el('input', {type:'number', step:'any', placeholder:t.angPlaceholder||'uhol (Â°)'});
        const btn = el('button', {}, 'SkontrolovaÅ¥');
        const msg = el('p',{class:'note'}, '');
        row.append(mag, ang); card.append(row, btn, msg);

        if(state.savedVals[t.id]){
          if(state.savedVals[t.id].mag!==undefined) mag.value = state.savedVals[t.id].mag;
          if(state.savedVals[t.id].ang!==undefined) ang.value = state.savedVals[t.id].ang;
        }

        if(solved){
          mag.value = t.magTarget.toFixed(3); ang.value = t.angTarget.toFixed(3);
          mag.disabled=true; ang.disabled=true; btn.disabled=true; msg.textContent='âœ… SprÃ¡vne!'; msg.className='note right';
        }

        btn.addEventListener('click', ()=>{
          const vMag = Number(String(mag.value).replace(',','.'));
          const vAng = Number(String(ang.value).replace(',','.'));
          if(isNaN(vMag) || isNaN(vAng)){ msg.textContent='Zadaj obe hodnoty (veÄ¾kosÅ¥ aj uhol).'; return; }
          state.savedVals[t.id] = {mag: mag.value, ang: ang.value}; saveState();
          const okMag = Math.abs(vMag - t.magTarget) <= (t.magTol||0.5);
          const okAng = Math.abs(vAng - t.angTarget) <= (t.angTol||1);
          if(okMag && okAng){
            state.solved[t.id]=true; saveState();
            msg.textContent='âœ… SprÃ¡vne!'; msg.className='note right';
            mag.disabled=true; ang.disabled=true; btn.disabled=true; updateProgress(); renderTasks();
          } else {
            let part = 'NÃ¡poveda: ' + t.hint;
            if(!okMag && okAng) part = 'VeÄ¾kosÅ¥ eÅ¡te nesedÃ­. ' + part;
            if(okMag && !okAng) part = 'Uhol eÅ¡te nesedÃ­. ' + part;
            if(!okMag && !okAng) part = 'NesedÃ­ veÄ¾kosÅ¥ ani uhol. ' + part;
            msg.textContent = 'âŒ ' + part; msg.className='note wrong';
          }
        });

      } else {
        const inp = el('input',{type:t.input||'text', placeholder:t.placeholder||''});
        const btn = el('button',{}, 'SkontrolovaÅ¥');
        const msg = el('p',{class:'note'}, '');
        if(state.savedVals[t.id]) inp.value = state.savedVals[t.id];
        if(solved){ inp.disabled=true; btn.disabled=true; msg.textContent='âœ… SprÃ¡vne!'; msg.className='note right'; }
        card.append(inp, btn, msg);

        btn.addEventListener('click',()=>{
          const val = (inp.value||'').trim().replace(',', '.');
          if(!val){ msg.textContent='Zadaj odpoveÄ.'; msg.className='note'; return; }
          const ok = t.solve(Number(val));
          state.savedVals[t.id]=val; saveState();
          if(ok){
            state.solved[t.id]=true; saveState();
            msg.textContent='âœ… SprÃ¡vne!'; msg.className='note right'; inp.disabled=true; btn.disabled=true; updateProgress(); renderTasks();
          } else {
            msg.textContent = `âŒ NesprÃ¡vne. NÃ¡poveda: ${t.hint}`; msg.className='note wrong';
          }
        });
      }

      tasksWrap.append(card);
    });

    updateProgress();
  }

  function drawPhasor(canvas, deg){
    const ctx = canvas.getContext('2d');
    const w = canvas.width = canvas.clientWidth; const h = canvas.height = canvas.clientHeight;
    const cx = w/2, cy = h*0.75; const r = Math.min(w, h)*0.35;
    ctx.clearRect(0,0,w,h);
    ctx.strokeStyle = '#284064'; ctx.lineWidth=1.2; ctx.beginPath(); ctx.moveTo(20,cy); ctx.lineTo(w-20,cy); ctx.stroke();
    ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2); ctx.strokeStyle='#22314d'; ctx.stroke();
    // prÃºd I (0Â°)
    ctx.strokeStyle = '#22c55e'; ctx.fillStyle = '#22c55e';
    arrow(ctx, cx, cy, cx+r, cy);
    ctx.fillText('I (0Â°)', cx+r+6, cy+4);
    // napÃ¤tie U (deg)
    const rad = deg*Math.PI/180; const ux = cx + r*Math.cos(rad); const uy = cy - r*Math.sin(rad);
    ctx.strokeStyle = '#5b9cff'; ctx.fillStyle = '#5b9cff';
    arrow(ctx, cx, cy, ux, uy);
    ctx.fillText(`U (${deg.toFixed(1)}Â°)`, ux+6, uy+4);
  }

  function arrow(ctx, x1,y1,x2,y2){
    ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
    const ang = Math.atan2(y2-y1, x2-x1); const len=10;
    ctx.beginPath();
    ctx.moveTo(x2,y2);
    ctx.lineTo(x2-len*Math.cos(ang-Math.PI/6), y2-len*Math.sin(ang-Math.PI/6));
    ctx.lineTo(x2-len*Math.cos(ang+Math.PI/6), y2-len*Math.sin(ang+Math.PI/6));
    ctx.closePath(); ctx.fill();
  }

  // ====================== NavigÃ¡cia ================================
  document.getElementById('btnStart').addEventListener('click',()=>{
    const name = document.getElementById('player').value.trim();
    if(!name){ document.getElementById('msgStart').textContent='Zadaj aspoÅˆ prezÃ½vku.'; return; }
    state.name=name; if(!state.startAt) state.startAt=Date.now(); saveState();
    document.getElementById('who').textContent = state.name;
    document.getElementById('screen-welcome').classList.add('hidden');
    document.getElementById('screen-game').classList.remove('hidden');
    renderTasks(); startTimer();
  });

  document.getElementById('btnBack').addEventListener('click',()=>{
    document.getElementById('screen-game').classList.add('hidden');
    document.getElementById('screen-welcome').classList.remove('hidden');
    stopTimer();
  });

  document.getElementById('btnResetAll').addEventListener('click',()=>{
    if(confirm('VymazaÅ¥ uloÅ¾enÃ½ postup?')){ localStorage.removeItem(STATE_KEY); location.reload(); }
  });

  // Auto-Å¡tart ak uÅ¾ je meno v localStorage
  if(state?.name){
    document.getElementById('player').value = state.name;
    document.getElementById('who').textContent = state.name;
    document.getElementById('screen-welcome').classList.add('hidden');
    document.getElementById('screen-game').classList.remove('hidden');
    renderTasks(); startTimer();
  }
  </script>
</body>
</html>
