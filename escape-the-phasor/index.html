escape-the-phasor/
    ‚îî‚îÄ‚îÄ index.html
<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Escape the Phasor ‚Äì ≈°kolsk√° √∫nikov√° hra (v5 ‚Äì pevn√© pozadia, silnej≈°ie rozjasnenie)</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root{ --txt:#e5e7eb; --muted:#9aa4b2; --acc:#5b9cff; --edge:#1f2a44;
           --bri:0.60; --con:1.00; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{ margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial; color:var(--txt); background:#0b1020; }
    .bg{ position:fixed; inset:0; z-index:-2; background-position:center; background-size:cover; background-attachment:fixed;
         transition: filter .7s ease, opacity .6s ease, background-image .4s ease-in-out;
         filter:brightness(var(--bri)) contrast(var(--con)); }
    .bg::after{ content:''; position:absolute; inset:0;
      background:radial-gradient(1100px 720px at 20% 0%, rgba(14,24,48,.6), rgba(11,16,32,.85));
      z-index:-1; pointer-events:none; }
    .wrap{max-width:1000px;margin:0 auto;padding:24px}
    .card{background:linear-gradient(180deg,rgba(18,27,48,.88),rgba(11,16,32,.88));border:1px solid var(--edge);border-radius:18px;padding:22px;box-shadow:0 12px 40px rgba(0,0,0,.35)}
    h1{margin:0 0 8px;font-size:clamp(22px,3.2vw,36px)}
    h2{margin:0 0 12px;font-size:clamp(18px,2.4vw,24px)}
    p{color:var(--muted);line-height:1.6}
    .row{display:grid;gap:18px}
    @media (min-width:860px){.row{grid-template-columns:1fr 1fr}}
    label{display:block;margin:10px 0 6px}
    input,button{width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--edge);background:#0a1222;color:#e5e7eb}
    input:focus,button:focus{outline:2px solid var(--acc)}
    button{background:var(--acc);border-color:var(--acc);font-weight:700;cursor:pointer}
    button.secondary{background:transparent;border-color:var(--edge)}
    button:disabled{opacity:.6;cursor:not-allowed}
    .hidden{display:none}
    .pill{display:inline-flex;gap:8px;align-items:center;font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--edge);background:#0a1222;color:#cbd5e1}
    .progress{height:10px;border-radius:999px;background:#0a1222;border:1px solid var(--edge);overflow:hidden;margin:12px 0}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,#22c55e,#5b9cff)}
    .grid{display:grid;gap:18px}
    .task{border:1px dashed var(--edge);border-radius:14px;padding:16px;background:rgba(8,13,26,.7);position:relative}
    .note{font-size:13px;color:#9aa4b2}
    .right{color:#22c55e} .wrong{color:#ef4444}
    .center{text-align:center}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#0a1222;border:1px solid var(--edge);border-radius:8px;padding:2px 6px}
    canvas{width:100%;max-width:620px;height:260px;background:#081024;border:1px solid var(--edge);border-radius:12px}
    .stageBadge{display:inline-block;margin:8px 0 0;padding:4px 10px;border-radius:999px;border:1px solid var(--edge);background:#0a1222;font-size:12px}
    .fade{animation:fade .5s ease}
    @keyframes fade { from{opacity:.3; transform:translateY(4px)} to{opacity:1; transform:none} }
  </style>
</head>
<body>
  <div class="bg" id="bg"></div>

  <div class="wrap">
    <section class="card" id="screen-welcome">
      <h1>Escape the Phasor</h1>
      <p>10 √∫loh v 3 etap√°ch. Pozadie laborat√≥ria sa s postupom v√Ωrazne rozjasn√≠.</p>
      <div class="row">
        <div>
          <label for="player">Meno / prez√Ωvka</label>
          <input id="player" placeholder="napr. Miro" />
          <button id="btnStart">Zaƒça≈• hru</button>
          <p id="msgStart" class="note"></p>
        </div>
        <div>
          <p class="note">T√°to verzia pou≈æ√≠va <b>pevn√© zabudovan√© pozadia</b> (bez mo≈ænosti nahr√°vania vlastn√Ωch).</p>
          <button id="btnResetAll" class="secondary">Vymaza≈• ulo≈æen√Ω postup</button>
        </div>
      </div>
    </section>

    <section class="card hidden" id="screen-game">
      <div class="row">
        <div>
          <h2 id="gameTitle">Etapa <span id="stageNum">1</span> / 3</h2>
          <div class="progress"><div class="bar" id="bar"></div></div>
          <p class="pill">Hr√°ƒç: <span id="who">‚Äì</span> ‚Ä¢ ƒåas: <span id="timer">00:00</span></p>
          <span class="stageBadge" id="stageBadge">üîí Najprv dokonƒçi aktu√°lnu etapu</span>
        </div>
        <div class="center">
          <button id="btnBack" class="secondary">Sp√§≈• na √∫vod</button>
        </div>
      </div>

      <div id="tasks" class="grid fade"></div>
      <div id="finish" class="hidden center fade">
        <h2>üéâ √önik sa podaril!</h2>
        <p>Skvel√©! M√°≈° v≈°etko hotov√©. ƒåas: <b><span id="finalTime">‚Äì</span></b>.</p>
      </div>
    </section>
  </div>

  <script>
  const BG_DEFAULTS = {
    s1: 'bg_stage1.jpg',
    s2: 'bg_stage2.jpg',
    s3: 'bg_stage3.jpg',
    fin: 'bg_final.jpg'
  };

  const $ = (s)=>document.querySelector(s);
  const el = (t,a={},h='')=>{ const n=document.createElement(t); for(const[k,v] of Object.entries(a)) n.setAttribute(k,v); if(h) n.innerHTML=h; return n; };
  const fmtTime = (ms)=>{ const s=Math.floor(ms/1000); const m=Math.floor(s/60); const r=s%60; return `${String(m).padStart(2,'0')}:${String(r).padStart(2,'0')}` };
  const nearly = (val, target, tol)=>(Math.abs(Number(val)-target) <= tol);
  const save = (k,v)=> localStorage.setItem(k, JSON.stringify(v));
  const load = (k,def)=>{ try{ const v=JSON.parse(localStorage.getItem(k)); return v??def; }catch{ return def; } };

  const TASKS = [
    { id:'u1', stage:1, title:'ƒåasov√Ω priebeh', text:'u(t) = 325¬∑sin(2œÄ¬∑50¬∑t). Urƒçi u pri t = 3 ms. (V)', input:'number', placeholder:'napr. 123', tol:2, solve:(v)=> nearly(v, 325*Math.sin(2*Math.PI*50*0.003), 2), hint:'u=Umax¬∑sin(œât), œâ=2œÄf, t=0,003 s.' },
    { id:'u2', stage:1, title:'Maxim√°lna hodnota', text:'Uef = 230 V ‚Üí urƒç Umax. (V)', input:'number', placeholder:'napr. 123', tol:1, solve:(v)=> nearly(v, 230*Math.SQRT2, 1), hint:'Umax = Uef¬∑‚àö2.' },
    { id:'u3', stage:1, title:'Efekt√≠vna hodnota', text:'Umax = 10 V ‚Üí urƒç Uef. (V)', input:'number', placeholder:'napr. 1.23', tol:0.05, solve:(v)=> nearly(v, 10/Math.SQRT2, 0.05), hint:'Uef = Umax/‚àö2.' },
    { id:'u4', stage:1, title:'Stredn√° hodnota', text:'Ustred ‚âà 0,637¬∑Umax. Ak Umax = 325 V ‚Üí Ustred? (V)', input:'number', placeholder:'napr. 123', tol:2, solve:(v)=> nearly(v, 0.637*325, 2), hint:'Ustred = (2/œÄ)¬∑Umax.' },
    { id:'u5', stage:1, title:'Odpor R', text:'U = 230 V, I = 2 A. R = ? (Œ©)', input:'number', placeholder:'napr. 123', tol:0.5, solve:(v)=> nearly(v, 115, 0.5), hint:'R = U/I.' },

    { id:'u6', stage:2, title:'Indukt√≠vna reaktancia X_L', text:'f = 50 Hz, L = 0,10 H ‚Üí X_L? (Œ©)', input:'number', placeholder:'napr. 12.3', tol:0.5, solve:(v)=> nearly(v, 2*Math.PI*50*0.10, 0.5), hint:'X_L = 2œÄfL.' },
    { id:'u7', stage:2, title:'Kapacitn√° reaktancia X_C', text:'f = 50 Hz, C = 100 ¬µF ‚Üí X_C? (Œ©)', input:'number', placeholder:'napr. 12.8', tol:0.5, solve:(v)=> nearly(v, 1/(2*Math.PI*50*100e-6), 0.5), hint:'X_C = 1/(2œÄfC).' },
    { id:'u8', stage:2, title:'Impedancia Z', text:'R = 40 Œ©, X_L = 30 Œ©, X_C = 10 Œ© ‚Üí Z? (Œ©)', input:'number', placeholder:'napr. 12.3', tol:0.5, solve:(v)=> nearly(v, Math.sqrt(40**2 + (30-10)**2), 0.5), hint:'Z = ‚àö(R¬≤ + (X_L‚àíX_C)¬≤).' },

    { id:'u9', stage:2, title:'Ohmov z√°kon pre AC ‚Äì f√°zory',
      text:'I = 2 A s œÜ_I = ‚àí10¬∞. R=40 Œ©, X_L=30 Œ©, X_C=10 Œ©. Urƒçi f√°zor U = I¬∑Z. Zadaj |U| (V) a œà_U (¬∞).',
      type:'phasorSolve', magPlaceholder:'napr. 12.3', angPlaceholder:'napr. 12.3',
      magTol:0.7, angTol:1.0,
      magTarget: 2*Math.sqrt(40*40 + (30-10)*(30-10)),
      angTarget: (-10) + Math.atan2(30-10,40)*180/Math.PI,
      hint:'|U| = I¬∑|Z|, œÜ_U = œÜ_I + œÜ_Z, priƒçom œÜ_Z = arctan((X_L‚àíX_C)/R).' },

    { id:'u10', stage:3, title:'F√°zor ‚Äì nastavenie', text:'Pre s√©riov√Ω RLC s R = 40 Œ© a X = (X_L‚àíX_C) = 20 Œ© nastav posuvn√≠kom f√°zov√Ω posun medzi U a I (¬∞).',
      type:'phasor', target: Math.atan2(20,40)*180/Math.PI, tol:2, hint:'œÜ = arctan((X_L ‚àí X_C)/R). Kladn√© ‚Üí U vedie I.' }
  ];

  const STATE_KEY = 'phasor-escape-state-v5';
  let state = load(STATE_KEY, { name:'', startAt:0, solved:{}, savedVals:{}, stage:1 });

  let tHandle=null;
  function startTimer(){ clearInterval(tHandle); tHandle = setInterval(()=>{ const now=Date.now(); if(!state.startAt) state.startAt=now; $('#timer').textContent = fmtTime(now - state.startAt); }, 250); }
  function stopTimer(){ clearInterval(tHandle); }
  function updateProgress(){ const done = Object.keys(state.solved).filter(k=> state.solved[k]).length; const pct = Math.round(100*done/TASKS.length); $('#bar').style.width = pct+'%'; }

  function setBg(url, bri, con){
    const bg = document.getElementById('bg');
    bg.style.backgroundImage = `url(${url})`;
    document.documentElement.style.setProperty('--bri', String(bri));
    document.documentElement.style.setProperty('--con', String(con));
  }

  function applyStageBg(){
    if(document.getElementById('finish').classList.contains('hidden')===false){
      setBg('bg_final.jpg', 1.35, 1.08); return;
    }
    if(state.stage===1){ setBg('bg_stage1.jpg', 0.58, 1.02); }
    if(state.stage===2){ setBg('bg_stage2.jpg', 0.90, 1.05); }
    if(state.stage===3){ setBg('bg_stage3.jpg', 1.20, 1.07); }
    document.getElementById('stageNum').textContent = state.stage;
    document.getElementById('stageBadge').textContent = (state.stage<3?'üîí Najprv dokonƒçi aktu√°lnu etapu':'üîí Fin√°lny z√°mok ‚Äì nastav f√°zu');
  }

  function nextStageIfReady(){
    const need = state.stage===1 ? 5 : (state.stage===2 ? 9 : 10);
    const done = Object.keys(state.solved).filter(k=> state.solved[k]).length;
    if(done>=need && state.stage<3){ state.stage += 1; save(STATE_KEY,state); renderTasks(true); }
    if(done===10){ document.getElementById('finish').classList.remove('hidden'); document.getElementById('finalTime').textContent = fmtTime(Date.now()-state.startAt); applyStageBg(); }
  }

  function renderTasks(scrollTop=false){
    const container = document.getElementById('tasks');
    container.innerHTML='';
    const nowStage = state.stage;
    TASKS.filter(t=> t.stage===nowStage).forEach((t)=>{
      const card = el('div',{class:'task fade', id:`task-${t.id}`});
      const h3 = el('h3',{}, t.title);
      const p = el('p',{}, t.text);
      card.append(h3,p);
      const solved = !!state.solved[t.id];

      if(t.type==='phasor'){
        const canvas = el('canvas',{id:`cv-${t.id}`});
        const slider = el('input',{type:'range', min:'-90', max:'90', step:'0.1', value: solved? t.target.toFixed(1): (state.savedVals[t.id]?.ang ?? '0')});
        const out = el('p',{class:'note'}, `Uhol œÜ: <b><span id="ang-${t.id}">${slider.value}</span>¬∞</b>`);
        const btn = el('button',{}, 'Skontrolova≈•');
        const msg = el('p',{class:'note'}, '');
        card.append(canvas, slider, out, btn, msg);
        try { drawPhasor(canvas, Number(slider.value)); } catch(e){}

        slider.addEventListener('input',()=>{
          document.querySelector('#ang-'+t.id).textContent = slider.value;
          state.savedVals[t.id] = {ang: slider.value}; save(STATE_KEY,state);
          try { drawPhasor(canvas, Number(slider.value)); } catch(e){}
        });

        if(solved){ slider.value=t.target.toFixed(1); slider.disabled=true; btn.disabled=true; out.innerHTML=`Uhol œÜ: <b>${slider.value}¬∞</b>`; msg.textContent='‚úÖ Spr√°vne!'; msg.className='note right'; }

        btn.addEventListener('click',()=>{
          const ang = Number(slider.value);
          if(Math.abs(ang - t.target) <= t.tol){
            state.solved[t.id]=true; save(STATE_KEY,state);
            msg.textContent='‚úÖ Spr√°vne!'; msg.className='note right';
            slider.disabled=true; btn.disabled=true;
            try{ drawPhasor(canvas, t.target); }catch(e){}
            updateProgress(); nextStageIfReady();
          } else {
            msg.textContent = `‚ùå E≈°te nie. N√°poveda: ${t.hint}`; msg.className='note wrong';
          }
        });

      } else if(t.type==='phasorSolve'){
        const row = el('div', {class:'row'});
        const mag = el('input', {type:'number', step:'any', placeholder:t.magPlaceholder||'veƒækos≈• (V)'});
        const ang = el('input', {type:'number', step:'any', placeholder:t.angPlaceholder||'uhol (¬∞)'});
        const btn = el('button', {}, 'Skontrolova≈•');
        const msg = el('p',{class:'note'}, '');
        row.append(mag, ang); card.append(row, btn, msg);

        if(state.savedVals[t.id]){ if(state.savedVals[t.id].mag!==undefined) mag.value=state.savedVals[t.id].mag; if(state.savedVals[t.id].ang!==undefined) ang.value=state.savedVals[t.id].ang; }
        if(solved){ mag.value=t.magTarget.toFixed(3); ang.value=t.angTarget.toFixed(3); mag.disabled=true; ang.disabled=true; btn.disabled=true; msg.textContent='‚úÖ Spr√°vne!'; msg.className='note right'; }

        btn.addEventListener('click',()=>{
          const vMag = Number(String(mag.value).replace(',','.'));
          const vAng = Number(String(ang.value).replace(',','.'));
          if(isNaN(vMag)||isNaN(vAng)){ msg.textContent='Zadaj obe hodnoty.'; return; }
          state.savedVals[t.id]={mag:mag.value, ang:ang.value}; save(STATE_KEY,state);
          const okMag = Math.abs(vMag - t.magTarget) <= (t.magTol||0.5);
          const okAng = Math.abs(vAng - t.angTarget) <= (t.angTol||1);
          if(okMag && okAng){
            state.solved[t.id]=true; save(STATE_KEY,state);
            msg.textContent='‚úÖ Spr√°vne!'; msg.className='note right';
            mag.disabled=true; ang.disabled=true; btn.disabled=true; updateProgress(); nextStageIfReady();
          } else {
            let part = 'N√°poveda: ' + t.hint;
            if(!okMag && okAng) part = 'Veƒækos≈• e≈°te nesed√≠. ' + part;
            if(okMag && !okAng) part = 'Uhol e≈°te nesed√≠. ' + part;
            if(!okMag && !okAng) part = 'Nesed√≠ veƒækos≈• ani uhol. ' + part;
            msg.textContent = '‚ùå ' + part; msg.className='note wrong';
          }
        });

      } else {
        const inp = el('input',{type:t.input||'text', placeholder:t.placeholder||''});
        const btn = el('button',{}, 'Skontrolova≈•');
        const msg = el('p',{class:'note'}, '');
        if(state.savedVals[t.id]) inp.value = state.savedVals[t.id];
        if(solved){ inp.disabled=true; btn.disabled=true; msg.textContent='‚úÖ Spr√°vne!'; msg.className='note right'; }
        card.append(inp, btn, msg);

        btn.addEventListener('click',()=>{
          const val = (inp.value||'').trim().replace(',', '.');
          if(!val){ msg.textContent='Zadaj odpoveƒè.'; msg.className='note'; return; }
          const ok = t.solve(Number(val));
          state.savedVals[t.id]=val; save(STATE_KEY,state);
          if(ok){
            state.solved[t.id]=true; save(STATE_KEY,state);
            msg.textContent='‚úÖ Spr√°vne!'; msg.className='note right'; inp.disabled=true; btn.disabled=true; updateProgress(); nextStageIfReady();
          } else {
            msg.textContent = `‚ùå Nespr√°vne. N√°poveda: ${t.hint}`; msg.className='note wrong';
          }
        });
      }

      container.append(card);
    });

    const allDone = Object.keys(state.solved).filter(k=> state.solved[k]).length === TASKS.length;
    document.getElementById('finish').classList.toggle('hidden', !allDone);
    applyStageBg();
    if(scrollTop) window.scrollTo({top:0, behavior:'smooth'});
    updateProgress();
  }

  function drawPhasor(canvas, deg){
    const ctx = canvas.getContext('2d');
    const w = canvas.width = canvas.clientWidth; const h = canvas.height = canvas.clientHeight;
    const cx = w/2, cy = h*0.75; const r = Math.min(w, h)*0.35;
    ctx.clearRect(0,0,w,h);
    ctx.strokeStyle = '#284064'; ctx.lineWidth=1.2; ctx.beginPath(); ctx.moveTo(20,cy); ctx.lineTo(w-20,cy); ctx.stroke();
    ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2); ctx.strokeStyle='#22314d'; ctx.stroke();
    ctx.strokeStyle = '#22c55e'; ctx.fillStyle = '#22c55e';
    arrow(ctx, cx, cy, cx+r, cy); ctx.fillText('I (0¬∞)', cx+r+6, cy+4);
    const rad = deg*Math.PI/180; const ux = cx + r*Math.cos(rad); const uy = cy - r*Math.sin(rad);
    ctx.strokeStyle = '#5b9cff'; ctx.fillStyle = '#5b9cff';
    arrow(ctx, cx, cy, ux, uy); ctx.fillText(`U (${deg.toFixed(1)}¬∞)`, ux+6, uy+4);
  }
  function arrow(ctx, x1,y1,x2,y2){
    ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
    const ang = Math.atan2(y2-y1, x2-x1); const len=10;
    ctx.beginPath(); ctx.moveTo(x2,y2);
    ctx.lineTo(x2-len*Math.cos(ang-Math.PI/6), y2-len*Math.sin(ang-Math.PI/6));
    ctx.lineTo(x2-len*Math.cos(ang+Math.PI/6), y2-len*Math.sin(ang+Math.PI/6));
    ctx.closePath(); ctx.fill();
  }

  document.getElementById('btnStart').addEventListener('click',()=>{
    const name = document.getElementById('player').value.trim();
    if(!name){ document.getElementById('msgStart').textContent='Zadaj aspo≈à prez√Ωvku.'; return; }
    state.name=name; if(!state.startAt) state.startAt=Date.now(); save(STATE_KEY,state);
    document.getElementById('who').textContent = state.name;
    document.getElementById('screen-welcome').classList.add('hidden');
    document.getElementById('screen-game').classList.remove('hidden');
    startTimer(); renderTasks(true);
  });
  document.getElementById('btnBack').addEventListener('click',()=>{
    document.getElementById('screen-game').classList.add('hidden');
    document.getElementById('screen-welcome').classList.remove('hidden');
    stopTimer();
  });
  document.getElementById('btnResetAll').addEventListener('click',()=>{
    if(confirm('Vymaza≈• ulo≈æen√Ω postup?')){ localStorage.removeItem(STATE_KEY); location.reload(); }
  });

  const persisted = load(STATE_KEY, null);
  if(persisted?.name){
    state = persisted;
    document.getElementById('player').value = state.name;
    document.getElementById('who').textContent = state.name;
    document.getElementById('screen-welcome').classList.add('hidden');
    document.getElementById('screen-game').classList.remove('hidden');
    startTimer(); renderTasks();
  } else {
    applyStageBg();
  }
  </script>
</body>
</html>
